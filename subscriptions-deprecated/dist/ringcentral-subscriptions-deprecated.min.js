!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@ringcentral/sdk"),require("pubnub")):"function"==typeof define&&define.amd?define(["ringcentral","pubnub"],e):"object"==typeof exports?exports.RingCentral=e(require("@ringcentral/sdk"),require("pubnub")):(t.RingCentral=t.RingCentral||{},t.RingCentral.SubscriptionsDeprecated=e(t.RingCentral,t.PubNub))}(self,((t,e)=>(()=>{"use strict";var r={702:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Subscriptions=void 0;var i=n(r(10)),s=n(r(807)),u=n(r(401)),o=function(){function t(t){var e=t.sdk,r=t.PubNub,n=void 0===r?i.default:r;this._sdk=e,this._PubNub=n,console.warn("PubNub support is deprecated. Please migrate your application to WebSockets.")}return t.prototype.createSubscription=function(t){var e=void 0===t?{}:t,r=e.pollInterval,n=e.renewHandicapMs;return new s.default({pollInterval:r,renewHandicapMs:n,sdk:this._sdk,PubNub:this._PubNub})},t.prototype.createCachedSubscription=function(t){var e=t.cacheKey,r=t.pollInterval,n=t.renewHandicapMs;return new u.default({cacheKey:e,pollInterval:r,renewHandicapMs:n,sdk:this._sdk,PubNub:this._PubNub})},t.prototype.getPubNub=function(){return this._PubNub},t}();e.Subscriptions=o,e.default=o},401:function(t,e,r){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=function(t){function e(e){var r=e.sdk,n=e.PubNub,i=e.cacheKey,s=e.pollInterval,u=e.renewHandicapMs,o=t.call(this,{sdk:r,PubNub:n,pollInterval:s,renewHandicapMs:u})||this;if(!i)throw new Error("Cached Subscription requires cacheKey parameter to be defined");return o._cacheKey=i,o}return i(e,t),e.prototype.subscription=function(){return this._sdk.cache().getItemSync(this._cacheKey)||{}},e.prototype._setSubscription=function(t){return this._sdk.cache().setItemSync(this._cacheKey,t),this},e.prototype.restore=function(t){return this.eventFilters().length||this.setEventFilters(t),this},e}(s(r(807)).default);e.default=u},807:function(t,e,r){var n,i=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),s=this&&this.__assign||function(){return s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},s.apply(this,arguments)},u=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function u(t){try{c(n.next(t))}catch(t){s(t)}}function o(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(u,o)}c((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,i,s,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(u=0)),u;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!((i=(i=u.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},c=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.events=void 0,c(r(10));var a,p=r(180),b=/(\+[\d]{2}):?([\d]{2})?$/,l=function(t,e,r){return"".concat(e,":").concat(r||"00")},h=function(t){return"string"==typeof(t=t||0)?Date.parse(t.replace(b,l)):t};!function(t){t.notification="notification",t.removeSuccess="removeSuccess",t.removeError="removeError",t.renewSuccess="renewSuccess",t.renewError="renewError",t.subscribeSuccess="subscribeSuccess",t.subscribeError="subscribeError",t.automaticRenewSuccess="automaticRenewSuccess",t.automaticRenewError="automaticRenewError"}(a=e.events||(e.events={}));var f=function(t){function e(e){var r=e.sdk,n=e.PubNub,i=e.pollInterval,s=void 0===i?1e4:i,u=e.renewHandicapMs,o=void 0===u?12e4:u,c=t.call(this)||this;return c.events=a,c._pubnub=null,c._pubnubLastChannel=null,c._pubnubLastSubscribeKey=null,c._timeout=null,c._subscription=null,c._automaticRenewPromise=null,c._sdk=r,c._PubNub=n,c._pollInterval=s,c._renewHandicapMs=o,c}return i(e,t),e.prototype.on=function(e,r){return t.prototype.on.call(this,e,r)},e.prototype.subscribed=function(){var t=this.subscription();return!!(t.id&&t.deliveryMode&&t.deliveryMode.subscriberKey&&t.deliveryMode.address)},e.prototype.alive=function(){return this.subscribed()&&Date.now()<this.expirationTime()},e.prototype.expired=function(){return!this.subscribed()||!this.subscribed()||Date.now()>h(this.subscription().expirationTime)},e.prototype.expirationTime=function(){return h(this.subscription().expirationTime)-this._renewHandicapMs},e.prototype.setSubscription=function(t){return t=t||{},this._clearTimeout(),this._setSubscription(t),this._subscribeAtPubNub(),this._setTimeout(),this},e.prototype.subscription=function(){var t=this._subscription||{};return s({},t)},e.prototype.pubnub=function(){return this._pubnub},e.prototype.register=function(){return u(this,void 0,void 0,(function(){return o(this,(function(t){return this.alive()?[2,this.renew()]:[2,this.subscribe()]}))}))},e.prototype.eventFilters=function(){return this.subscription().eventFilters||[]},e.prototype.addEventFilters=function(t){return this.setEventFilters(this.eventFilters().concat(t)),this},e.prototype.setEventFilters=function(t){var e=this.subscription();return e.eventFilters=t,this._setSubscription(e),this},e.prototype.subscribe=function(){return u(this,void 0,void 0,(function(){var t,e,r;return o(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,3,,4]),this._clearTimeout(),!this.eventFilters().length)throw new Error("Events are undefined");return[4,this._sdk.platform().post("/restapi/v1.0/subscription",{eventFilters:this._getFullEventFilters(),deliveryMode:{transportType:"PubNub"}})];case 1:return[4,(t=n.sent()).json()];case 2:return e=n.sent(),this.setSubscription(e).emit(this.events.subscribeSuccess,t),[2,t];case 3:throw r=n.sent(),this.reset().emit(this.events.subscribeError,r),r;case 4:return[2]}}))}))},e.prototype.renew=function(){return u(this,void 0,void 0,(function(){var t,e,r;return o(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,3,,4]),this._clearTimeout(),!this.subscribed())throw new Error("No subscription");if(!this.eventFilters().length)throw new Error("Events are undefined");return[4,this._sdk.platform().put("/restapi/v1.0/subscription/".concat(this.subscription().id),{eventFilters:this._getFullEventFilters()})];case 1:return[4,(t=n.sent()).json()];case 2:return e=n.sent(),this.setSubscription(e).emit(this.events.renewSuccess,t),[2,t];case 3:throw r=n.sent(),this.reset().emit(this.events.renewError,r),r;case 4:return[2]}}))}))},e.prototype.remove=function(){return u(this,void 0,void 0,(function(){var t,e;return o(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),!this.subscribed())throw new Error("No subscription");return[4,this._sdk.platform().delete("/restapi/v1.0/subscription/".concat(this.subscription().id))];case 1:return t=r.sent(),this.reset().emit(this.events.removeSuccess,t),[2,t];case 2:throw e=r.sent(),this.emit(this.events.removeError,e),e;case 3:return[2]}}))}))},e.prototype.resubscribe=function(){var t=this.eventFilters();return this.reset().setEventFilters(t).subscribe()},e.prototype.reset=function(){return this._clearTimeout(),this._unsubscribeAtPubNub(),this._setSubscription(null),this},e.prototype._setSubscription=function(t){return this._subscription=s({},t),this},e.prototype._getFullEventFilters=function(){var t=this;return this.eventFilters().map((function(e){return t._sdk.platform().createUrl(e)}))},e.prototype._automaticRenewHandler=function(){return u(this,void 0,void 0,(function(){var t,e;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.alive()?[2]:(this._clearTimeout(),[4,this.expired()?this.subscribe():this.renew()]);case 1:return t=r.sent(),this.emit(this.events.automaticRenewSuccess,t),[3,3];case 2:return e=r.sent(),this.emit(this.events.automaticRenewError,e),[3,3];case 3:return[2]}}))}))},e.prototype._setTimeout=function(){var t=this;if(this._clearTimeout(),!this.alive())throw new Error("Subscription is not alive");return this._timeout=setInterval((function(){return u(t,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this._automaticRenewPromise||(this._automaticRenewPromise=this._automaticRenewHandler()),[4,this._automaticRenewPromise];case 1:return t.sent(),this._automaticRenewPromise=null,[2]}}))}))}),this._pollInterval),this},e.prototype.automaticRenewing=function(){return this._automaticRenewPromise},e.prototype._clearTimeout=function(){return clearInterval(this._timeout),this},e.prototype._decrypt=function(t){if(!this.subscribed())throw new Error("No subscription");return this.subscription().deliveryMode.encryptionKey&&(t=this._pubnub.decrypt(t,this.subscription().deliveryMode.encryptionKey,{encryptKey:!1,keyEncoding:"base64",keyLength:128,mode:"ecb"})),t},e.prototype._notify=function(t){return this.emit(this.events.notification,this._decrypt(t)),this},e.prototype._subscribeAtPubNub=function(){var t=this;if(!this.alive())throw new Error("Subscription is not alive");var e=this.subscription().deliveryMode,r=e.address,n=e.subscriberKey;if(this._pubnub){if(this._pubnubLastChannel===r)return this;this._pubnubLastSubscribeKey&&this._pubnubLastSubscribeKey!==n?this._unsubscribeAtPubNub():this._pubnubLastChannel&&this._pubnub.unsubscribeAll()}if(!this._pubnub){this._pubnubLastSubscribeKey=n;var i=this._PubNub;this._pubnub=new i({ssl:!0,restore:!0,subscribeKey:n,useRandomIVs:!1}),this._pubnub.addListener({status:function(t){},message:function(e){return t._notify(e.message)}})}return this._pubnubLastChannel=r,this._pubnub.subscribe({channels:[r]}),this},e.prototype._unsubscribeAtPubNub=function(){return this.subscribed()&&this._pubnub?(this._pubnub.unsubscribeAll(),this._pubnub.removeAllListeners(),this._pubnubLastSubscribeKey=null,this._pubnubLastChannel=null,this._pubnub=null,this):this},e.prototype.resubscribeAtPubNub=function(){return u(this,void 0,void 0,(function(){return o(this,(function(t){return this._unsubscribeAtPubNub(),[2,this.register()]}))}))},e}(p.SDK.EventEmitter);e.default=f},180:e=>{e.exports=t},10:t=>{t.exports=e}},n={},i=function t(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}};return r[e].call(s.exports,s,s.exports,t),s.exports}(702);return i.default})()));
//# sourceMappingURL=ringcentral-subscriptions-deprecated.min.js.map